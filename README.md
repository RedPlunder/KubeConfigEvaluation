# KubeConfigEvaluation
Explore more new metric to evaluate the Config Answer generated by LLM

整个动态验证的流程，先是 yamllint 静态语法检查，而后使用 kubeval 进行 Kubernetes API 规范验证，使用 datree 进行安全性检查，最后再使用 kubectl apply -f 进行实际部署测试

你可以按照下面的流程先把环境装好、流程跑通

> yamllint 与 kubeval 不需要了，datree 组件本身就包含了yaml语法校验，而且yamllint的校验也非常奇怪，kubeval 由于早就停止了维护，只能离线手动下载特定版本的 Scheme 文件，导致不能很好地校验
> 
> 总之直接安装 kubeconform 与 datree 即可

# 环境安装

这边建议使用 Ubunut >= 20.04（这样能兼容 claude code 等 Agent 使用）

## 安装 datree
```bash

# 无法使用网上一些所谓的 curl https://get.datree.io | /bin/bash 方法，会遇到无法解析域名的错误（不知道是不是国内的 DNS 服务器问题），建议使用以下步骤安装
# [原网址](https://github.com/datreeio/datree/releases)
wget https://github.com/datreeio/datree/releases/download/1.9.22-rc/datree-cli_1.9.22-rc_Linux_x86_64.zip
unzip datree-cli_1.9.22-rc_Linux_x86_64.zip
sudo mv datree /usr/local/bin/

# 验证
datree version

# Usage

datree config set offline local # 设置 datree 工作为离线模式，不需要联网，这样之后才能正常直接使用
datree test <generated.yaml>
```

## 安装 kubeconform

```
# 1. 直接使用 golang 辅助安装
# With a specific version tag
$ go install github.com/yannh/kubeconform/cmd/kubeconform@v0.4.13

# Latest version
$ go install github.com/yannh/kubeconform/cmd/kubeconform@latest


# 2. 若是不想安装 golang，也可以直接下载 x86_64 架构下的压缩包手动安装
curl -L https://github.com/yannh/kubeconform/releases/latest/download/kubeconform-linux-amd64.tar.gz | tar xvzf - && \
sudo mv kubeconform /usr/local/bin/
```
## 安装 Kubernetes

比较复杂，比较网上一般都比较详细，可以上网自行安装


---------------以下是被废弃的方法--------------------------

## 安装 yamllint
```bash

apt install yamllint

# Usage
yamllint <generated.yaml>

```


## 安装 kubeval
```bash

# Linux/macOS
wget https://github.com/instrumenta/kubeval/releases/latest/download/kubeval-linux-amd64.tar.gz
tar xf kubeval-linux-amd64.tar.gz
sudo mv kubeval /usr/local/bin

# 验证安装
kubeval --version

# Usage
kubeval <generated.yaml>
```


# 使用脚本尝试一键验证

1. 首先，需要你将所需要验证的YAML文本统一放在工作目录 ./manifests/ 内（名字可以自定义）

For example:

```
# 目录示例

|---/Other Dirs
|---/manifests/
    |----1.yaml
    |----2.yaml
    |----3.yaml
    .....
    |----99.yaml
    |----100.yaml
```

static_autoValid.sh 脚本的使用方法：
```
./static_autoValid.sh {DirectoryName}   # 会按升序自动扫描 DirectoryName 文件夹内所有的 yaml 文件
```

2. 直接运行 static_autoValid.sh 脚本，生成 kubeconform.log 与 datree.log 两个文件
3. 再继续运行 auto_run.sh, 会在 auto_run_log 文件夹下生成日志文件
