apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: amq-artemis
  labels:
    app.kubernetes.io/name: amq-artemis
    app.kubernetes.io/component: ingress
  annotations:
    # External DNS / cert-manager (keep your real values)
    external-dns.alpha.kubernetes.io/hostname: your-artemis.example.com
    external-dns.alpha.kubernetes.io/ingress-hostname-source: annotation-only
    cert-manager.io/cluster-issuer: your-cluster-issuer
    cert-manager.io/duration: 2160h
    cert-manager.io/renew-before: 720h

    # NGINX basic tuning
    nginx.ingress.kubernetes.io/keepalive_timeout: "1200"
    nginx.ingress.kubernetes.io/proxy-body-size: "250m"
    nginx.ingress.kubernetes.io/proxy-buffers-number: "4 256k"
    nginx.ingress.kubernetes.io/proxy-buffering: "on"
    nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"

    # Optional: session affinity via cookie (without invalid path)
    nginx.ingress.kubernetes.io/affinity: "cookie"
    nginx.ingress.kubernetes.io/session-cookie-name: "amq-artemis"
    nginx.ingress.kubernetes.io/session-cookie-samesite: "None"
    nginx.ingress.kubernetes.io/session-cookie-secure: "true"

    # Optional: extra NGINX tuning
    nginx.ingress.kubernetes.io/configuration-snippet: |
      proxy_busy_buffers_size   256k;
      client_body_buffer_size   10m;
      send_timeout              300;
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - your-artemis.example.com
      secretName: artemis-fqdn-cert
  rules:
    - host: your-artemis.example.com
      http:
        paths:
          # Route the Artemis console and everything under it
          - path: /console
            pathType: Prefix
            backend:
              service:
                name: amq-artemis
                port:
                  number: 8161